<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			*{
				margin: 0;
				padding: 0;
			}
			body{
				background-image:url('img/map.png');
				background-position: 0 0;
				background-repeat: repeat;
			}
			#yxbox{
				padding: 0;
				margin:0 auto;
				margin-top:32px;
				list-style: none;
				position:relative;
			}
			#yxbox li{
				width:32px;
				height:32px;
				float: left;
			}
			#yxbox .pos0{
				background:url('img/World_A2.png') no-repeat;
				background-position: -128px 0;
			}
			#yxbox .pos1{
				background:url('img/Inside_A2.png') no-repeat;
				background-position: -64px 0;
			}
			#yxbox .pos2{
				background:url('img/World_A2.png') no-repeat;
				background-position: 0 0;
			}
			#yxbox .pos3{
				background:url('img/Inside_A2.png') no-repeat;
				background-position: -128px -288px;
			}
			#yxbox .person1,#yxbox .person2,#yxbox .person3,#yxbox .person4{
				width:32px;
				height:32px;
				position:absolute;
				background-image:url('img/People4.png');
				background-repeat: no-repeat;
			}
			#yxbox .box{
				width:32px;
				height:32px;
				position:absolute;
				background-image:url('img/Other1.png');
				background-position: 0 0;
				background-repeat: no-repeat;
			}
			#yxbox .person3{
				background-position:-224px 0px;
			}
			#yxbox .person2{
				background-position:-224px -32px ;
			}
			#yxbox .person4{
				background-position:-224px -64px;
			}
			#yxbox .person1{
				background-position:-224px -96px;
			}
		</style>
	</head>
	<body>
		
		<ul id="yxbox">
		
		</ul>
		<script type="text/javascript">
			GameBox={
				oP:null,
				history:[],
				target:{},
				boxs:[],
				aMap:[
					{
						map:[
							1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
							1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
						],
						BoxPos:[
							{x:2,y:1},
							{x:4,y:1},
							{x:6,y:1},
							{x:8,y:1},
							{x:11,y:1},
							{x:13,y:1},
							{x:15,y:1},
							{x:17,y:1},
							{x:1,y:2},
							{x:3,y:2}, 
							{x:5,y:2},
							{x:7,y:2},
							{x:9,y:2},
							{x:10,y:2},
							{x:12,y:2},
							{x:14,y:2},
							{x:16,y:2},
							{x:18,y:2}, 
							{x:2,y:3},
							{x:4,y:3},
							{x:6,y:3},
							{x:8,y:3},
							{x:11,y:3},
							{x:13,y:3},
							{x:15,y:3},
							{x:17,y:3},
							{x:1,y:4},
							{x:3,y:4},
							{x:5,y:4},
							{x:7,y:4},
							{x:9,y:4},
							{x:10,y:4},
							{x:12,y:4},
							{x:14,y:4},
							{x:16,y:4},
							{x:18,y:4},
							{x:2,y:5},
							{x:4,y:5},
							{x:6,y:5},
							{x:8,y:5},
							{x:11,y:5},
							{x:13,y:5},
							{x:15,y:5},
							{x:17,y:5},
							{x:1,y:6},
							{x:3,y:6},
							{x:5,y:6},
							{x:7,y:6},
							{x:9,y:6},
							{x:10,y:6},
							{x:12,y:6},
							{x:14,y:6},
							{x:16,y:6},
							{x:18,y:6},
							{x:2,y:7},
							{x:4,y:7},
							{x:6,y:7},
							{x:8,y:7},
							{x:11,y:7},
							{x:13,y:7},
							{x:15,y:7},
							{x:17,y:7},
							{x:1,y:8},
							{x:3,y:8},
							{x:5,y:8},
							{x:7,y:8},
							{x:9,y:8},
							{x:10,y:8},
							{x:12,y:8},
							{x:14,y:8},
							{x:16,y:8},
							{x:18,y:8},
							{x:2,y:9},
							{x:4,y:9},
							{x:6,y:9},
							{x:8,y:9},
							{x:11,y:9},
							{x:13,y:9},
							{x:15,y:9},
							{x:17,y:9},
							{x:1,y:10},
							{x:3,y:10},
							{x:5,y:10},
							{x:7,y:10},
							{x:9,y:10},
							{x:10,y:10},
							{x:12,y:10},
							{x:14,y:10},
							{x:16,y:10},
							{x:18,y:10},
							{x:2,y:11},
							{x:4,y:11},
							{x:6,y:11},
							{x:8,y:11},
							{x:11,y:11},
							{x:13,y:11},
							{x:15,y:11},
							{x:17,y:11},
							{x:1,y:12},
							{x:3,y:12},
							{x:5,y:12},
							{x:7,y:12},
							{x:9,y:12},
							{x:10,y:12},
							{x:12,y:12},
							{x:14,y:12},
							{x:16,y:12},
							{x:18,y:12},
							{x:2,y:13},
							{x:4,y:13},
							{x:6,y:13},
							{x:8,y:13},
							{x:11,y:13},
							{x:13,y:13},
							{x:15,y:13},
							{x:17,y:13},
							{x:1,y:14},
							{x:3,y:14},
							{x:5,y:14},
							{x:7,y:14},
							{x:9,y:14},
							{x:10,y:14},
							{x:12,y:14},
							{x:14,y:14},
							{x:16,y:14},
							{x:18,y:14},
							{x:2,y:15},
							{x:4,y:15},
							{x:6,y:15},
							{x:8,y:15},
							{x:11,y:15},
							{x:13,y:15},
							{x:15,y:15},
							{x:17,y:15},
							{x:1,y:16},
							{x:3,y:16},
							{x:5,y:16},
							{x:7,y:16},
							{x:9,y:16},
							{x:10,y:16},
							{x:12,y:16},
							{x:14,y:16},
							{x:16,y:16},
							{x:18,y:16},
							{x:2,y:17},
							{x:4,y:17},
							{x:6,y:17},
							{x:8,y:17},
							{x:11,y:17},
							{x:13,y:17},
							{x:15,y:17},
							{x:17,y:17}
						],
						pPos:{x:10,y:18}
					}
				],
				createMap:function(gk){
					document.title='当前第'+(this.num+1)+'关';
					this.colsNum=Math.sqrt(gk.map.length);
					this.oParent.style.width=this.colsNum*32+'px';
					for(var i=0;i<gk.map.length;i++){
						var oLi=document.createElement('li');
						oLi.className='pos'+gk.map[i];
						this.oParent.appendChild(oLi);
						if(gk.map[i]==3){
							this.target[oLi.offsetLeft+'.'+oLi.offsetTop]='1';
						}
					}
					this.createMan(gk);
				},
				createMan:function(gk){
					this.oP=document.createElement('div');
					this.oP.className='person2';
					this.oP.x=gk.pPos.x;
					this.oP.y=gk.pPos.y;
					this.oP.style.left=this.oP.x*32+'px';
					this.oP.style.top=this.oP.y*32+'px';
					this.oParent.appendChild(this.oP);
					this.createBox(gk);
				},
				createBox:function(gk){
					for(var i=0;i<gk.BoxPos.length;i++){
						var oDiv=document.createElement('div');
						oDiv.className='box';
						oDiv.style.left=gk.BoxPos[i].x*32+'px';
						oDiv.style.top=gk.BoxPos[i].y*32+'px';
						this.oParent.appendChild(oDiv);
						this.boxs.push(oDiv);
					}
				},
				personRun:function(iJson){
					var gk=this.aMap[this.num];
					var map= gk.map;
					var x=this.oP.x+iJson.x;
					var y=this.oP.y+iJson.y;
					var bx=x+iJson.x;
					var by=y+iJson.y;
					if(map[this.colsNum*y+x]==1){
						return;
					}
					this.oP.x=x;
					this.oP.y=y;
					this.oP.style.left=this.oP.x*32+'px';
					this.oP.style.top=this.oP.y*32+'px';
					for(var i=0;i<this.boxs.length;i++){
						if(this.impactCheck(this.oP,this.boxs[i])){
							if(map[this.colsNum*by+bx]==1){
								this.oP.x=x-iJson.x;
								this.oP.y=y-iJson.y;
								this.oP.style.left=this.oP.x*32+'px';
								this.oP.style.top=this.oP.y*32+'px';
								return;
							}
							this.boxs[i].style.left=bx*32+'px';
							this.boxs[i].style.top=by*32+'px';
							for(var j=0;j<this.boxs.length;j++){
								if(this.boxs[i]!=this.boxs[j]&&this.impactCheck(this.boxs[i],this.boxs[j])){
									this.oP.x=x-iJson.x;
									this.oP.y=y-iJson.y;
									this.oP.style.left=this.oP.x*32+'px';
									this.oP.style.top=this.oP.y*32+'px';
									this.boxs[i].style.left=(bx-iJson.x)*32+'px';
									this.boxs[i].style.top=(by-iJson.y)*32+'px';
									return;
								}
							}
							
							break;
						}
						if(this.target[this.oP.offsetLeft+'.'+this.oP.offsetTop]){//过关判定
									this.nextLevel();
							}
							else{
								this.boxs[i].clear=false;
							}
					}
					if(this.preTmp){
						this.history.push(this.preTmp);
					}
					this.preTmp={
						boxPos:[]
					};
					this.preTmp.pPos={
						x:this.oP.x,
						y:this.oP.y
					};
					for(var i=0;i<this.boxs.length;i++){
						this.preTmp.boxPos[i]={
							x:this.boxs[i].offsetLeft,
							y:this.boxs[i].offsetTop
						}
					}
					if(this.history.length>20){
						this.history.splice(0,1);
					}
				},
				nextLevel:function(){
					this.history=[];
					this.target=[];this.boxs=[];
					this.oParent.innerHTML='';
					this.num++;
					if(!this.aMap[this.num]){
						alert('恭喜您已通关！！！');
						return false;
					}
					this.createMap(this.aMap[this.num]);
				},
				impactCheck:function(obj1,obj2){
					var l1=obj1.offsetLeft;
					var t1=obj1.offsetTop;
					var r1=l1+obj1.offsetWidth;
					var b1=t1+obj1.offsetHeight;
					var l2=obj2.offsetLeft;
					var t2=obj2.offsetTop;
					var r2=l2+obj2.offsetWidth;
					var b2=t2+obj2.offsetHeight;
					if(b1<=t2||l1>=r2||t1>=b2||r1<=l2){
						return false;
					}
					else{
						return true;
					}
				},

				ini:function(oParent,num){
					this.oParent=oParent;
					this.num=num;
					var gk=this.aMap[num];
					this.createMap(gk);
					var self=this;
					onkeydown=function(ev){
						var oEvent=ev||event;
						switch(oEvent.keyCode){
							case 37://left
								self.oP.className='person2';
								self.personRun({x:-1,y:0});
								break;
							case 38://up
								self.oP.className='person1';
								self.personRun({x:0,y:-1});
								break;
							case 39://right
								self.oP.className='person4';
								self.personRun({x:1,y:0});
								break;
							case 40://down
								self.oP.className='person3';
								self.personRun({x:0,y:1});
								break;
							default:
								break;
						}
					}
				}
			}
			GameBox.ini(document.getElementById('yxbox'),0);
		</script>
	</body>
</html>
